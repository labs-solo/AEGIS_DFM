# Appendix B — Unified Storage Table

**Unified Vault Storage Map (Slots 0–24):** The table below presents the complete storage slot allocation for VaultManagerCore as of the Phase 7 freeze. It lists each slot, the variable(s) stored at that location, the data type and size, and the phase in which the slot was introduced or first used. This reflects the final state of the contract’s storage through version 2.0.

|  **Slot** | **Offset** | **Variable (Type)**                                                    | **Size (bits)** | **Phase** | **Description**                                                                                                                                                                                                                                                                                                   |
| --------: | ---------: | ---------------------------------------------------------------------- | --------------: | :-------: | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
|     **0** |          0 | `owner` (address)                                                      |             160 |     1     | **Vault Owner** – Contract owner (governance or timelock). Stored as a 20-byte address.                                                                                                                                                                                                                           |
|           |         20 | `pauseFlags` (uint96)                                                  |              96 |     1     | **Pause Flags** – 96-bit bitmap of global pause settings. Each bit toggles a category of operations (bits 0–9 defined; see governance docs). Packed with owner for single SLOAD.                                                                                                                                  |
|     **1** |          0 | `authorizedHookAddress` (address)                                      |             160 |     1     | **Authorized Hook** – Address of the Uniswap V4 hook contract (Spot module) that is allowed to call VaultManagerCore. Set at deployment and immutable.                                                                                                                                                            |
|     **2** |          0 | `policyManager` (address)                                              |             160 |     1     | **Policy Manager** – Address of the risk manager module (PoolPolicyManager). Handles collateral factors, interest model links, etc.                                                                                                                    |
|     **3** |          0 | `poolManager` (address)                                                |             160 |     2     | **Uniswap PoolManager** – Address of Uniswap V4’s PoolManager contract. Enables adding/removing liquidity via the hook.                                                                                                                                                        |
|     **4** |          0 | `positionManager` (address)                                            |             160 |     2     | **Uniswap PositionManager** – Address of Uniswap V4’s non-fungible Position Manager (for LP NFTs).                                                                                                                                                                  |
|     **5** |          0 | *Reserved* (unused)                                                    |             256 |     1     | **(Legacy IRM Slot)** – Placeholder for an interest rate model mapping.                                                                                                                                                                         |
|     **6** |          0 | `shareData` (mapping(PoolId ⇒ ShareInfo))                              |             256 |     1     | **Global Share Data** – Mapping for each pool’s total share supply info. `ShareInfo` contains the total LP shares minted and any locked shares (if applicable).                                                                                                                           |
|     **7** |          0 | `userVaults` (mapping(PoolId ⇒ mapping(address ⇒ UserVault)))          |             256 |     1     | **User Vaults** – Nested mapping tracking each user’s vault data per pool. **`UserVault` struct** spans 3 slots per user: it includes token balances, share balance, borrow shares, and a position count. |
|     **8** |          0 | `pendingFees` (mapping(PoolId ⇒ PendingFees))                          |             256 |     2     | **Pending Fees** – Mapping of unreinvensted fee amounts for each pool. `PendingFees` is a struct with `{uint128 token0; uint128 token1;}` representing accrued swap fees awaiting reinvestment.                                                                                                 |
|     **9** |          0 | `borrowIndices` (mapping(PoolId ⇒ BorrowIndex))                        |             256 |     3     | **Borrow Index** – Mapping of per-pool interest accrual info. `BorrowIndex` struct contains `{uint128 shareIndex; uint40 lastAccrueTime; uint88 _reserved;}` tracking the cumulative interest factor.          |
|    **10** |          0 | `positionIds` (mapping(PoolId ⇒ uint256))                              |             256 |     2     | **Full-Range NFT ID** – Mapping to store the Vault’s primary Uniswap position ID per pool (for the default full-range position).                                                                                                                                                                |
|    **11** |          0 | `reinvestmentPaused` (bool)                                            |               8 |     2     | **Reinvest Pause** – Global boolean flag to pause automatic fee reinvestment. Consumes 1 byte (rest of slot 11 is unused gap). Added in Phase 2.                                                                                                                                                                  |
|    **12** |          0 | `lastReinvestment` (mapping(PoolId ⇒ uint256))                         |             256 |     2     | **Last Reinvest Time** – Mapping tracking the timestamp of the last fee reinvestment for each pool. To enforce per-pool reinvest cooldowns.                                                                                                                                                      |
|    **13** |          0 | `totalBorrowShares` (mapping(PoolId ⇒ uint256))                        |             256 |     3     | **Total Borrow Shares** – Mapping of the aggregate outstanding borrow shares for each pool. This tracks the total nominal debt across all users in share units. Added in Phase 3.                                                                                                                                 |
|    **14** |          0 | `interestRateModel` (mapping(PoolId ⇒ address))                        |             256 |     3     | **Interest Rate Model** – Mapping to the interest rate model contract address for each pool. Determines interest accrual rates. Introduced in Phase 3.                                                                                                                                                            |
|    **15** |          0 | *Reserved* (unused)                                                    |             256 |     3     | **(Phase 3 Spare)** – Unused slot left as a buffer during Phase 3 expansion. Intentionally left blank for possible future lending-related data.                                                                                                                                                                   |
|    **16** |          0 | `lpPositionMeta` (mapping(PoolId ⇒ mapping(uint256 ⇒ LPPositionMeta))) |             256 |     4     | **LP Position Meta** – Nested mapping holding metadata for each concentrated LP position opened as collateral. Keys are poolId and the position’s NFT ID. `LPPositionMeta` struct includes details like the position’s tick range and liquidity.            |
|    **17** |          0 | `positionOwnerIndex` (mapping(PoolId ⇒ mapping(address ⇒ uint256\[]))) |             256 |     4     | **Position Owner Index** – Nested mapping for quick lookup of position IDs by owner address (per pool). Maps each pool and user to an array of that user’s active LP position IDs.                                                                                                              |
|    **18** |          0 | `badDebt` (mapping(PoolId ⇒ uint256))                                  |             256 |     6     | **Bad Debt** – Mapping of outstanding bad debt for each pool (in base units, e.g. raw token amount or equivalent). When a liquidation leaves debt uncollateralized, this records the amount for potential repayment by the protocol.                                                            |
| **19–22** |          – | *(Reserved – Hard Gap)*                                                |         4 × 256 |    5–6    | **Hard Reserve** – Four-slot gap reserved for future expansion (Phase 5 planning). Intended for order-book or time-weighted oracle data that was not ultimately implemented. These slots are **never to be reused** without a migration.                                                                    |
|    **23** |          0 | `TimelockConfig` (struct)                                              |             256 |     7     | **Timelock Config** – Struct holding governance timelock parameters. Contains `{address timelockAddr; uint64 minDelay; uint64 gracePeriod;}` packed into one slot (20 + 8 + 8 bytes).                                                                        |
|    **24** |          0 | `MetricsAccumulator` (struct)                                          |             256 |     7     | **Metrics Accumulator** – Struct for aggregated vault metrics, packed as `{uint96 totalCollateral; uint96 totalDebt; uint96 protocolLiquidity; uint32 lastUpdateBlock;}`. Allows periodic emission of system stats.                                                         |

**Notes:** All multi-byte fields use **big-endian packing** within their slot (e.g. in slot 0, `owner` occupies bytes 0–19 and `pauseFlags` bytes 20–31). Mappings and dynamic arrays occupy a single **hash slot** (with actual entries stored at `keccak256(key ‖ slot)` as per Solidity rules). The gas costs listed (2100 for cold SLOAD, 100 for warm) reflect typical access for those slots in Ethereum’s Istanbul/EIP-2929 context.
